%The goal of this code is to generate a figure showing the fraction of
%connections made onto PNs by ipsi and contra axons


%% Load annotations and connectors

% Load annotations json. Generated by Wei's code gen_annotation_map.py
annotations=loadjson('~/tracing/sid_by_annotation.json');

% Return all skeleton IDs for R and L ORNs

ORNs_Left=annotations.Left_0x20_ORN;
ORNs_Right=annotations.Right_0x20_ORN;

%exclude unilateral ORNs for now

ORNs=[ORNs_Left, ORNs_Right];

%return all skeleton IDs of DM6 PNs
PNs=sort(annotations.DM6_0x20_PN);


%% Load postsynaptic skeleton info


load('~/Documents/MATLAB/tracingCode2/currentWfly1ManuscriptFigures/Supplementals/axonCollaterals/ipsiContraPolyady/rightPostSkelsBySyn')
load('~/Documents/MATLAB/tracingCode2/currentWfly1ManuscriptFigures/Supplementals/axonCollaterals/ipsiContraPolyady/leftPostSkelsBySyn')



% For each ORN collect its total number of connections within each
% glomerulus as well as the total number of PN connections

leftCounter=1;
rightCounter=1;

for o=1:length(ORNs)
    
    leftRunT=[];
    leftRunP=[];
   
   
    
    
    for j=1:size(leftPostSkelsBySyn{o},2)
        
        leftRunT=[leftRunT, leftPostSkelsBySyn{o}{j}];
        leftRunP=[leftRunP,leftPostSkelsBySyn{o}{j}(ismember(leftPostSkelsBySyn{o}{j},PNs))];
       
    end
    
    if isempty(leftRunP)==1
        
    else
        
        leftTotCon(leftCounter)=numel(leftRunT);
        leftPNCon(leftCounter)=numel(leftRunP);
    
        leftCounter=leftCounter+1;
        
    end
    
    rightRunT=[];
    rightRunP=[];
   
   
    
    
    for j=1:size(rightPostSkelsBySyn{o},2)
        
        rightRunT=[rightRunT, rightPostSkelsBySyn{o}{j}];
        rightRunP=[rightRunP,rightPostSkelsBySyn{o}{j}(ismember(rightPostSkelsBySyn{o}{j},PNs))];
       
    end
    
    if isempty(rightRunP)==1
        
    else
        
        rightTotCon(rightCounter)=numel(rightRunT);
        rightPNCon(rightCounter)=numel(rightRunP);
   
        rightCounter=rightCounter+1;
        
    end
end


%% Plotting


figure()
set(gcf,'Color', 'w')


h=boxplot([ [leftPNCon(1:27)./leftTotCon(1:27),rightPNCon(27:end)./rightTotCon(27:end),...
   leftPNCon(28:end)./leftTotCon(28:end),rightPNCon(1:26)./rightTotCon(1:26) ]'], [ones(53,1); 2*ones(51,1)],...
   'Color','k', 'Notch','on');

h.LineWidth = 2;



ax=gca;
ax.XTickLabel={'Ipsi Axons','Contra Axons'};
ylabel('Fraction PN Connections', 'FontSize',16)
ylim([0 .6])




ax.FontSize=16;
axis square

saveas(gcf,'ipsiContraFractPNConns')
saveas(gcf,'ipsiContraFractPNConns','epsc')



