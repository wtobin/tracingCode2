%This script collectis information from the files found in
%~/tracing/connectionNums and saves .mat files 


% Load annotations json. Generated by Wei's code gen_annotation_map.py
annotations=loadjson('~/tracing/sid_by_annotation.json');

% Return all skeleton IDs for R and L ORNs

ORNs_Left=annotations.Left_0x20_ORN;
ORNs_Right=annotations.Right_0x20_ORN;

ORNs=[ORNs_Left, ORNs_Right];

%return all skeleton IDs of DM6 PNs
PNs=sort(annotations.DM6_0x20_PN);


% return all skel IDs with *LN* in fieldname
Fn = fieldnames(annotations);
selFn = Fn(~cellfun(@isempty,regexp(Fn,'LN')));

LNs=[];
for i = 1:numel(selFn)
    LNs=[LNs, annotations.(selFn{i})];
end

LNs = unique(LNs);

%Load the connector structure
load('~/tracing/conns.mat')

%gen conn fieldname list
connFields=fieldnames(conns);


cd('~/tracing/connectionNums/orns')

for o=1:length(ORNs)
    
    x=load([num2str(ORNs(o)),'_ToPNs.mat']);
    ornsToPn(o,:)=x.ornToPn;
    
    y=load([num2str(ORNs(o)),'_ToLNs.mat']);
    ornsToLn(o,:)=y.ornToLn;
    
    z=load([num2str(ORNs(o)),'_ToORNs.mat']);
    ornsToOrn(o,:)=z.ornToOrn;
    
    
end

save('~/Documents/MATLAB/tracingCode2/wfly1_Manuscript/ornToOrn.mat','ornsToOrn')
save('~/Documents/MATLAB/tracingCode2/wfly1_Manuscript/ornToPn.mat','ornsToPn')
save('~/Documents/MATLAB/tracingCode2/wfly1_Manuscript/ornToLn.mat','ornsToLn')


cd('~/tracing/connectionNums/PNs')

for p=1:length(PNs)
    
    x=load([num2str(PNs(p)),'_ToPNs.mat']);
    pnToPn(p,:)=x.pnToPn;
    
    y=load([num2str(PNs(p)),'_ToLNs.mat']);
    pnToLn(p,:)=y.pnToLn;
    
    z=load([num2str(PNs(p)),'_ToORNs.mat']);
    pnToOrn(p,:)=z.pnToOrn;
    
    
end

save('~/Documents/MATLAB/tracingCode2/wfly1_Manuscript/pnToOrn.mat','pnToOrn')
save('~/Documents/MATLAB/tracingCode2/wfly1_Manuscript/pnToPn.mat','pnToPn')
save('~/Documents/MATLAB/tracingCode2/wfly1_Manuscript/pnToLn.mat','pnToLn')



cd('~/tracing/connectionNums/LNs')

for l=1:length(LNs)
    
    x=load([num2str(LNs(l)),'_ToPNs.mat']);
    lnToPn(l,:)=x.lnToPn;
    
    y=load([num2str(LNs(l)),'_ToLNs.mat']);
    lnToLn(l,:)=y.lnToLn;
    
    z=load([num2str(LNs(l)),'_ToORNs.mat']);
    lnToOrn(l,:)=z.lnToOrn;
    
    
end

save('~/Documents/MATLAB/tracingCode2/wfly1_Manuscript/lnToOrn.mat','lnToOrn')
save('~/Documents/MATLAB/tracingCode2/wfly1_Manuscript/lnToPn.mat','lnToPn')
save('~/Documents/MATLAB/tracingCode2/wfly1_Manuscript/lnToLn.mat','lnToLn')


